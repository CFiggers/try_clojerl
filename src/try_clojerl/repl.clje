(ns try-clojerl.repl)

(defn init
  [req state]
  (let [opts #erl{:compress     true
                  :idle_timeout 600000}]
    #erl[:cowboy_websocket req state opts]))

(defn websocket_handle [in-frame state]
  (let* [#erl[_ body] in-frame
         result (try (eval (read-string body))
                     (catch _ e e))
         resp-body (pr-str result)
         out-frame #erl[:text resp-body]]
    #erl[:reply out-frame state]))

(defn websocket_info [_info state]
  #erl[:ok state])
